# Arduino超音波センサー連携機能

## 概要
MediaPipeで顔認識を行い、顔が検出された時のみArduino超音波センサーからの距離データを使用して動画を制御する機能です。

## 機能
- 顔認識時：動画表示、距離に応じてフレーム位置変更
- 顔未検出時：背景色のみ表示
- Arduino連携：顔認識中のみ超音波センサーから距離取得

## 必要な部品
- Arduino Uno（または互換機）
- HC-SR04超音波センサー
- ジャンパーワイヤー
- USBケーブル

## 回路配線
```
Arduino  |  HC-SR04
---------|----------
GND      |  GND
5V       |  VCC
Pin 9    |  Trig
Pin 10   |  Echo
```

## セットアップ手順

### 1. 必要なライブラリをインストール
```bash
pip install pyserial
```

### 2. Arduinoプログラムのアップロード
1. Arduino IDEを開く
2. `arduino_ultrasonic_sensor.ino`ファイルを開く
3. ArduinoをPCに接続
4. 正しいCOMポートを選択
5. プログラムをアップロード

### 3. 接続テスト
```bash
python test_arduino_connection.py
```

### 4. メインアプリケーションでの使用
1. `portraits_experience.py`を実行
2. 「Arduino超音波センサーを使用」にチェック
3. 適切なCOMポートを設定
4. カメラの前に顔を向けると動画が表示される
5. 顔が検出されている間、Arduino距離データで動画位置が制御される

## トラブルシューティング

### Arduino接続エラー
- COMポートが正しく設定されているか確認
- Arduinoドライバがインストールされているか確認
- 他のアプリケーションがCOMポートを使用していないか確認

### 距離データが取得できない
- 超音波センサーの配線を確認
- シリアルモニターでArduinoからのデータを確認
- 超音波センサーの有効距離（2-400cm）内にいるか確認

### 顔認識が機能しない
- カメラが正しく接続されているか確認
- 十分な照明があるか確認
- MediaPipeの検出信頼度を調整

## 設定パラメータ

### 距離設定
- `DIST_MAX`: 170.0cm（動画の最初フレーム）
- `DIST_MIN`: 120.0cm（動画の最後フレーム）

### 顔認識設定
- `min_detection_confidence`: 0.3（検出信頼度）

## 使用例
1. 顔をカメラに向ける
2. 距離に応じて動画のフレームが変化
3. 顔を隠すと背景色のみ表示
4. 再び顔を見せると動画表示が復活

## 注意事項
- Arduino接続時は他のシリアル通信ソフトウェア（Arduino IDEのシリアルモニター等）を閉じてください
- 超音波センサーは音波を使用するため、音を吸収する素材（カーテン、クッション等）があると正確な測定ができない場合があります
- 距離測定は環境温度の影響を受ける場合があります 